<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="keywords"
      content="microfrontend, micro frontend, micro frontends, micro-frontend, micro-frontends, microservice, javascript"
    />
    <link rel="stylesheet" href="/qiankun/umi.e131109d.css" />
    <script>
      window.routerBase = "/qiankun";
    </script>
    <script>
      //! umi version: 3.3.3
    </script>
    <script>
      var _hmt = _hmt || [];
    </script>
    <script>
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0f738d9b0ac90574c09183ea85bcfa2e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <title>项目实践</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/zh/guide/tutorial" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" href="/qiankun/zh">qiankun</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a aria-current="page" class="active" href="/qiankun/zh/guide">指南</a></span><span><a href="/qiankun/zh/api">API</a></span><span><a href="/qiankun/zh/faq">常见问题</a></span><span><a href="/qiankun/zh/cookbook">入门教程</a></span><span>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/guide/tutorial">English</a></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" href="/qiankun/zh"></a><h1>qiankun</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/qiankun/zh/guide">指南</a></li><li><a href="/qiankun/zh/api">API</a></li><li><a href="/qiankun/zh/faq">常见问题</a></li><li><a href="/qiankun/zh/cookbook">入门教程</a></li><li>版本公告<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">发布日志<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="/qiankun/zh/cookbook#从-1x-版本升级到-2x-版本">升级指南</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/zh/">1.x 版本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/guide/tutorial">English</a></div></div><ul class="__dumi-default-menu-list"><li><a href="/qiankun/zh/guide">介绍</a></li><li><a href="/qiankun/zh/guide/getting-started">快速上手</a></li><li><a aria-current="page" class="active" href="/qiankun/zh/guide/tutorial">项目实践</a><ul role="slug-list"><li title="主应用" data-depth="2"><a href="/qiankun/zh/guide/tutorial#主应用"><span>主应用</span></a></li><li title="微应用" data-depth="2"><a href="/qiankun/zh/guide/tutorial#微应用"><span>微应用</span></a></li><li title="React 微应用" data-depth="3"><a href="/qiankun/zh/guide/tutorial#react-微应用"><span>React 微应用</span></a></li><li title="Vue 微应用" data-depth="3"><a href="/qiankun/zh/guide/tutorial#vue-微应用"><span>Vue 微应用</span></a></li><li title="Angular 微应用" data-depth="3"><a href="/qiankun/zh/guide/tutorial#angular-微应用"><span>Angular 微应用</span></a></li><li title="非 webpack 构建的微应用" data-depth="3"><a href="/qiankun/zh/guide/tutorial#非-webpack-构建的微应用"><span>非 webpack 构建的微应用</span></a></li><li title="umi-qiankun 项目" data-depth="3"><a href="/qiankun/zh/guide/tutorial#umi-qiankun-项目"><span>umi-qiankun 项目</span></a></li></ul></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="项目实践"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#项目实践"><span class="icon,icon-link"></span></a>项目实践</h1><p>本教程适合刚接触 <code>qiankun</code> 的新人，介绍了如何从 0 构建一个 <code>qiankun</code> 项目。</p><h2 id="主应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#主应用"><span class="icon,icon-link"></span></a>主应用</h2><p>主应用不限技术栈，只需要提供一个容器 DOM，然后注册微应用并 <code>start</code> 即可。</p><p>先安装 <code>qiankun</code> ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">$ </span><span class="token function">yarn</span><span class="token plain"> </span><span class="token function">add</span><span class="token plain"> qiankun </span><span class="token comment"># 或者 npm i qiankun -S</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>注册微应用并启动：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> registerMicroApps</span><span class="token punctuation">,</span><span class="token plain"> start </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;qiankun&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;reactApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:3000&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-react&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;vueApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;angularApp&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;//localhost:4200&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-angular&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 启动 qiankun</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#微应用"><span class="icon,icon-link"></span></a>微应用</h2><p>微应用分为有 <code>webpack</code> 构建和无 <code>webpack</code> 构建项目，有 <code>webpack</code> 的微应用（主要是指Vue、React、Angular）需要做的事情有：</p><ol><li><p>新增 <code>public-path.js</code> 文件，用于修改运行时的 <code>publicPath</code>。<a target="_blank" rel="noopener noreferrer" href="https://webpack.docschina.org/guides/public-path/#on-the-fly">什么是运行时的 publicPath ？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><div class="__dumi-default-alert">注意：运行时的 publicPath 和构建时的 publicPath 是不同的，两者不能等价替代。</div></li><li><p>子应用建议使用 <code>history</code> 模式的路由，需要设置路由 <code>base</code>，值和它的 <code>activeRule</code> 是一样的。</p></li><li><p>在入口文件最顶部引入 <code>public-path.js</code>，修改并导出三个生命周期函数。</p></li><li><p>修改 <code>webpack</code> 打包，允许开发环境跨域和 <code>umd</code> 打包。</p></li></ol><p>主要的修改就是以上四个，可能会根据项目的不同情况而改变。例如，你的项目是 <code>index.html</code> 和其他的所有文件分开部署的，说明你们已经将构建时的 <code>publicPath</code> 设置为了完整路径，则不用修改运行时的 <code>publicPath</code> （第一步操作可省）。</p><p>无 <code>webpack</code> 构建的微应用直接将 <code>lifecycles</code> 挂载到 <code>window</code> 上即可。</p><h3 id="react-微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#react-微应用"><span class="icon,icon-link"></span></a>React 微应用</h3><p>以 <code>create react app</code> 生成的 <code>react 16</code> 项目为例，搭配 <code>react-router-dom</code> 5.x。</p><ol><li><p>在 <code>src</code> 目录新增 <code>public-path.js</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  __webpack_public_path__ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>设置 <code>history</code> 模式路由的 <code>base</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&lt;BrowserRouter basename={window.__POWERED_BY_QIANKUN__ ? &#x27;/app-react&#x27; : &#x27;/&#x27;}&gt;</span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>入口文件 <code>index.js</code> 修改，为了避免根 id <code>#root</code> 与其他的 DOM 冲突，需要限制查找范围。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;./public-path&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;react-dom&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./App&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token plain"> container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;[react16] react app bootstraped&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;[react16] props from main framework&#x27;</span><span class="token punctuation">,</span><span class="token plain"> props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">unmountComponentAtNode</span><span class="token punctuation">(</span><span class="token plain">container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#root&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>修改 <code>webpack</code> 配置</p><p>安装插件 <code>@rescripts/cli</code>，当然也可以选择其他的插件，例如 <code>react-app-rewired</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-dash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">npm i -D @rescripts/cli</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>根目录新增 <code>.rescriptsrc.js</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./package&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">webpack</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token parameter">config</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">library</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">-[name]</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">libraryTarget</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;umd&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">jsonpFunction</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">webpackJsonp_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">globalObject</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;window&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> config</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function-variable function">devServer</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token parameter">_</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> config </span><span class="token operator">=</span><span class="token plain"> _</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">headers</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&#x27;Access-Control-Allow-Origin&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;*&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">historyApiFallback</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">hot</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">watchContentBase</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    config</span><span class="token punctuation">.</span><span class="token property-access">liveReload</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> config</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>修改 <code>package.json</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">-   &quot;start&quot;: &quot;react-scripts start&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+   &quot;start&quot;: &quot;rescripts start&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token deleted-sign deleted">-   &quot;build&quot;: &quot;react-scripts build&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+   &quot;build&quot;: &quot;rescripts build&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token deleted-sign deleted">-   &quot;test&quot;: &quot;react-scripts test&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+   &quot;test&quot;: &quot;rescripts test&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token deleted-sign deleted">-   &quot;eject&quot;: &quot;react-scripts eject&quot;</span></div><div class="token-line"><span class="token deleted-sign deleted"></span></div></pre></div></li></ol><h3 id="vue-微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#vue-微应用"><span class="icon,icon-link"></span></a>Vue 微应用</h3><p>以 <code>vue-cli 3+</code> 生成的 <code>vue 2.x</code> 项目为例，<code>vue 3</code> 版本等稳定后再补充。</p><ol><li><p>在 <code>src</code> 目录新增 <code>public-path.js</code>：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  __webpack_public_path__ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>入口文件 <code>main.js</code> 修改，为了避免根 id <code>#app</code> 与其他的 DOM 冲突，需要限制查找范围。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;./public-path&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">Vue</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;vue&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">VueRouter</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;vue-router&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./App.vue&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> routes </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./router&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> store </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;./store&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Vue</span><span class="token punctuation">.</span><span class="token property-access">config</span><span class="token punctuation">.</span><span class="token property-access">productionTip</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> router </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> instance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter punctuation">{</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> container </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> props</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  router </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    base</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue/&#x27;</span><span class="token plain"> </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;/&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    mode</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;history&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    routes</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  instance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    router</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    store</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">render</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token parameter">h</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">h</span><span class="token punctuation">(</span><span class="token maybe-class-name">App</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">$mount</span><span class="token punctuation">(</span><span class="token plain">container </span><span class="token operator">?</span><span class="token plain"> container</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;#app&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 独立运行时</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">bootstrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;[vue] vue app bootstraped&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;[vue] props from main framework&#x27;</span><span class="token punctuation">,</span><span class="token plain"> props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  instance</span><span class="token punctuation">.</span><span class="token method function property-access">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  instance</span><span class="token punctuation">.</span><span class="token property-access">$el</span><span class="token punctuation">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  instance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  router </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>打包配置修改（<code>vue.config.js</code>）：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./package&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  devServer</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    headers</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&#x27;Access-Control-Allow-Origin&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;*&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  configureWebpack</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      library</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">-[name]</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      libraryTarget</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;umd&#x27;</span><span class="token punctuation">,</span><span class="token comment">// 把微应用打包成 umd 库格式</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      jsonpFunction</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">webpackJsonp_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">name</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li></ol><h3 id="angular-微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#angular-微应用"><span class="icon,icon-link"></span></a>Angular 微应用</h3><p>以 <code>Angular-cli 9</code> 生成的 <code>angular 9</code> 项目为例，其他版本的 <code>angular</code> 后续会逐渐补充。</p><ol><li><p>在 <code>src</code> 目录新增 <code>public-path.js</code> 文件，内容为：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// eslint-disable-next-line no-undef</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  __webpack_public_path__ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>设置 <code>history</code> 模式路由的 <code>base</code>，<code>src/app/app-routing.module.ts</code> 文件：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token inserted-sign inserted">+ import { APP_BASE_HREF } from &#x27;@angular/common&#x27;;</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain">@NgModule({</span></div><div class="token-line"><span class="token plain"></span><span class="token unchanged">  imports: [RouterModule.forRoot(routes)],</span></div><div class="token-line"><span class="token unchanged">  exports: [RouterModule],</span></div><div class="token-line"><span class="token unchanged">  // @ts-ignore</span></div><div class="token-line"><span class="token unchanged"></span><span class="token inserted-sign inserted">+  providers: [{ provide: APP_BASE_HREF, useValue: window.__POWERED_BY_QIANKUN__ ? &#x27;/app-angular&#x27; : &#x27;/&#x27; }]</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token plain">})</span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>修改入口文件，<code>src/main.ts</code> 文件。</p><div class="__dumi-default-code-block"><pre class="prism-code language-ts"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token string">&#x27;./public-path&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> enableProdMode</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">NgModuleRef</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;@angular/core&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> platformBrowserDynamic </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;@angular/platform-browser-dynamic&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">AppModule</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./app/app.module&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> environment </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./environments/environment&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">environment</span><span class="token punctuation">.</span><span class="token property-access">production</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">enableProdMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> app</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">void</span><span class="token plain"> </span><span class="token operator">|</span><span class="token plain"> </span><span class="token maybe-class-name">NgModuleRef</span><span class="token operator">&lt;</span><span class="token maybe-class-name">AppModule</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  app </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token function">platformBrowserDynamic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">bootstrapModule</span><span class="token punctuation">(</span><span class="token maybe-class-name">AppModule</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token plain"> </span><span class="token keyword">as</span><span class="token plain"> </span><span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">bootstrap</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token parameter punctuation">:</span><span class="token parameter"> Object</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">mount</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token parameter punctuation">:</span><span class="token parameter"> Object</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">unmount</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token parameter punctuation">:</span><span class="token parameter"> Object</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// @ts-ignore</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  app</span><span class="token punctuation">.</span><span class="token method function property-access">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>修改 <code>webpack</code> 打包配置</p><p>先安装 <code>@angular-builders/custom-webpack</code> 插件，<strong>注意：<code>angular 9</code> 项目只能安装 <code>9.x</code> 版本，<code>angular 10</code> 项目可以安装最新版</strong>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i @angular-builders/custom-webpack@9.2.0 -D</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在根目录增加 <code>custom-webpack.config.js</code> ，内容为：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> appName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;./package.json&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  devServer</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    headers</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token string">&#x27;Access-Control-Allow-Origin&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;*&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    library</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">appName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">-[name]</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    libraryTarget</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;umd&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    jsonpFunction</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">webpackJsonp_</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">appName</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>修改 <code>angular.json</code>，将 <code>[packageName] &gt; architect &gt; build &gt; builder</code> 和 <code>[packageName] &gt; architect &gt; serve &gt; builder</code> 的值改为我们安装的插件，将我们的打包配置文件加入到 <code>[packageName] &gt; architect &gt; build &gt; options</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- &quot;builder&quot;: &quot;@angular-devkit/build-angular:browser&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+ &quot;builder&quot;: &quot;@angular-builders/custom-webpack:browser&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token unchanged">  &quot;options&quot;: {</span></div><div class="token-line"><span class="token unchanged"></span><span class="token inserted-sign inserted">+    &quot;customWebpackConfig&quot;: {</span></div><div class="token-line"><span class="token inserted-sign inserted">+      &quot;path&quot;: &quot;./custom-webpack.config.js&quot;</span></div><div class="token-line"><span class="token inserted-sign inserted">+    }</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token unchanged">  }</span></div><div class="token-line"><span class="token unchanged"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- &quot;builder&quot;: &quot;@angular-devkit/build-angular:dev-server&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+ &quot;builder&quot;: &quot;@angular-builders/custom-webpack:dev-server&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span></div></pre></div></li><li><p>解决 <code>zone.js</code> 的问题</p><p>在<strong>父应用</strong>引入 <code>zone.js</code>，需要在 <code>import qiankun</code> 之前引入。</p><p>将微应用的 <code>src/polyfills.ts</code> 里面的引入 <code>zone.js</code> 代码删掉。</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- import &#x27;zone.js/dist/zone&#x27;;</span></div><div class="token-line"><span class="token deleted-sign deleted"></span></div></pre></div><p>在微应用的 <code>src/index.html</code> 里面的 <code>&lt;head&gt;</code> 标签加上下面内容，微应用独立访问时使用。</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">&lt;!-- 也可以使用其他的CDN/本地的包 --&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">https://unpkg.com/zone.js</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">ignore</span><span class="token tag punctuation">&gt;</span><span class="token script"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>修正 <code>ng build</code> 打包报错问题，修改 <code>tsconfig.json</code> 文件，参考<a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/issues/431">issues/431<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- &quot;target&quot;: &quot;es2015&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+ &quot;target&quot;: &quot;es5&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted">+ &quot;typeRoots&quot;: [</span></div><div class="token-line"><span class="token inserted-sign inserted">+   &quot;node_modules/@types&quot;</span></div><div class="token-line"><span class="token inserted-sign inserted">+ ],</span></div><div class="token-line"><span class="token inserted-sign inserted"></span></div></pre></div></li><li><p>为了防止主应用或其他微应用也为 <code>angular</code> 时，<code>&lt;app-root&gt;&lt;/app-root&gt;</code> 会冲突的问题，建议给<code>&lt;app-root&gt;</code> 加上一个唯一的 id，比如说当前应用名称。</p><p>src/index.html ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- &lt;app-root&gt;&lt;/app-root&gt;</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+ &lt;app-root id=&quot;angular9&quot;&gt;&lt;/app-root&gt;</span></div><div class="token-line"><span class="token inserted-sign inserted"></span></div></pre></div><p>src/app/app.component.ts ：</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted">- selector: &#x27;app-root&#x27;,</span></div><div class="token-line"><span class="token deleted-sign deleted"></span><span class="token inserted-sign inserted">+ selector: &#x27;#angular9 app-root&#x27;,</span></div><div class="token-line"><span class="token inserted-sign inserted"></span></div></pre></div></li></ol><p>当然，也可以选择使用 <code>single-spa-angular</code> 插件，参考<a target="_blank" rel="noopener noreferrer" href="https://single-spa.js.org/docs/ecosystem-angular"> single-spa-angular 的官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/tree/master/examples/angular9">angular demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="非-webpack-构建的微应用"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#非-webpack-构建的微应用"><span class="icon,icon-link"></span></a>非 webpack 构建的微应用</h3><p>一些非 <code>webpack</code> 构建的项目，例如 <code>jQuery</code> 项目、<code>jsp</code> 项目，都可以按照这个处理。</p><p>接入之前请确保你的项目里的图片、音视频等资源能正常加载，如果这些资源的地址都是完整路径（例如 <code>https://qiankun.umijs.org/logo.png</code>），则没问题。如果都是相对路径，需要先将这些资源上传到服务器，使用完整路径。</p><p>接入非常简单，只需要额外声明一个 <code>script</code>，用于 <code>export</code> 相对应的 <code>lifecycles</code>。例如:</p><ol><li><p>声明 entry 入口</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-arrow deleted">&lt;!DOCTYPE html&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted">&lt;html lang=&quot;en&quot;&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted">&lt;head&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted"></span><span class="token unchanged">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span></div><div class="token-line"><span class="token unchanged">  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></div><div class="token-line"><span class="token unchanged">  &lt;title&gt;Purehtml Example&lt;/title&gt;</span></div><div class="token-line"><span class="token unchanged"></span><span class="token deleted-arrow deleted">&lt;/head&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted">&lt;body&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted"></span><span class="token unchanged">  &lt;div&gt;</span></div><div class="token-line"><span class="token unchanged">    Purehtml Example</span></div><div class="token-line"><span class="token unchanged">  &lt;/div&gt;</span></div><div class="token-line"><span class="token unchanged"></span><span class="token deleted-arrow deleted">&lt;/body&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted"></span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token inserted-sign inserted">+ &lt;script src=&quot;//yourhost/entry.js&quot; entry&gt;&lt;/script&gt;</span></div><div class="token-line"><span class="token inserted-sign inserted"></span><span class="token deleted-arrow deleted">&lt;/html&gt;</span></div><div class="token-line"><span class="token deleted-arrow deleted"></span></div></pre></div></li><li><p>在 entry js 里声明 lifecycles</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">render</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&#x27;#purehtml-container&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">html</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, render with jQuery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  global</span><span class="token punctuation">[</span><span class="token string">&#x27;purehtml&#x27;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">bootstrap</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;purehtml bootstrap&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">mount</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;purehtml mount&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">render</span><span class="token punctuation">(</span><span class="token plain">$</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function-variable function">unmount</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;purehtml unmount&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li></ol><p>你也可以直接参照 examples 中 purehtml 部分的<a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/tree/master/examples/purehtml">代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>同时，你也需要开启相关资源的 CORS，具体请参照<a href="/qiankun/zh/guide/tutorial#%E5%BE%AE%E5%BA%94%E7%94%A8%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%80%E5%AE%9A%E8%A6%81%E6%94%AF%E6%8C%81%E8%B7%A8%E5%9F%9F%E5%90%97%EF%BC%9F">此处</a></p><h3 id="umi-qiankun-项目"><a aria-hidden="true" tabindex="-1" href="/qiankun/zh/guide/tutorial#umi-qiankun-项目"><span class="icon,icon-link"></span></a>umi-qiankun 项目</h3><p><code>umi-qiankun</code> 的教程请移步 <a target="_blank" rel="noopener noreferrer" href="https://umijs.org/zh-CN/plugins/plugin-qiankun">umi 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/umi-plugin-qiankun/tree/master/examples">umi-qiankun 的官方 demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/kuitos/qiankun/edit/master/docs/guide/tutorial.zh.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">12/31/2020, 05:55:51</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-157295698-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/qiankun/umi.05f478ba.js"></script>
  </body>
</html>
