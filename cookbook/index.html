<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="keywords"
      content="microfrontend, micro frontend, micro frontends, micro-frontend, micro-frontends, microservice, javascript"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="https://gw.alipayobjects.com/mdn/rms_655822/afts/img/A*4sIUQpcos_gAAAAAAAAAAAAAARQnAQ"
    />
    <style>
      html .__dumi-default-layout-hero {
        padding: 140px 0;
        background: #21144d no-repeat bottom/cover
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1600 900'%3E%3Cpolygon fill='%23f3c200' points='957 450 539 900 1396 900'/%3E%3Cpolygon fill='%23e26003' points='957 450 872.9 900 1396 900'/%3E%3Cpolygon fill='%23ecb500' points='-60 900 398 662 816 900'/%3E%3Cpolygon fill='%23d86200' points='337 900 398 662 816 900'/%3E%3Cpolygon fill='%23e4a800' points='1203 546 1552 900 876 900'/%3E%3Cpolygon fill='%23ce6400' points='1203 546 1552 900 1162 900'/%3E%3Cpolygon fill='%23dc9b00' points='641 695 886 900 367 900'/%3E%3Cpolygon fill='%23c46500' points='587 900 641 695 886 900'/%3E%3Cpolygon fill='%23d38f00' points='1710 900 1401 632 1096 900'/%3E%3Cpolygon fill='%23ba6600' points='1710 900 1401 632 1365 900'/%3E%3Cpolygon fill='%23ca8300' points='1210 900 971 687 725 900'/%3E%3Cpolygon fill='%23b16600' points='943 900 1210 900 971 687'/%3E%3C/svg%3E");
      }
      html .__dumi-default-layout-hero h1 {
        color: #f3f3f3;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      html .__dumi-default-layout-hero .markdown {
        color: #eee;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }
    </style>
    <link rel="stylesheet" href="/qiankun/umi.6e48760e.css" />
    <script>
      window.routerBase = "/qiankun";
    </script>
    <script>
      //! umi version: 3.5.15
    </script>
    <script>
      !(function () {
        var e = localStorage.getItem("dumi:prefers-color"),
          t = window.matchMedia("(prefers-color-scheme: dark)").matches,
          r = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === r[2] ? (t ? r[1] : r[0]) : r.includes(e) ? e : r[0]
        );
      })();
    </script>
    <script>
      var _hmt = _hmt || [];
    </script>
    <script>
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?0f738d9b0ac90574c09183ea85bcfa2e";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <title>Tutorial</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/cookbook" data-show-sidemenu="true" data-show-slugs="false" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/">qiankun</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/qiankun/guide">Guide</a></span><span><a href="/qiankun/api">API</a></span><span><a href="/qiankun/faq">FAQ</a></span><span><a aria-current="page" class="active" href="/qiankun/cookbook">Tutorial</a></span><span>Version Notice<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">Changelog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a aria-current="page" class="active" href="/qiankun/cookbook#upgrade-from-1x-version-to-2x-version">Upgrade Guide</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/">1.x Version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/zh/cookbook">中文</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;https://gw.alipayobjects.com/zos/bmw-prod/8a74c1d3-16f3-4719-be63-15e467a68a24/km0cv8vn_w500_h500.png&#x27;)" href="/qiankun/"></a><h1>qiankun</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/qiankun/guide">Guide</a></li><li><a href="/qiankun/api">API</a></li><li><a href="/qiankun/faq">FAQ</a></li><li><a aria-current="page" class="active" href="/qiankun/cookbook">Tutorial</a></li><li>Version Notice<ul><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun/releases">Changelog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a aria-current="page" class="active" href="/qiankun/cookbook#upgrade-from-1x-version-to-2x-version">Upgrade Guide</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://v1.qiankun.umijs.org/">1.x Version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/umijs/qiankun">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><div class="__dumi-default-locale-select" data-locale-count="2"><a href="/qiankun/zh/cookbook">中文</a></div><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a aria-current="page" class="active" href="/qiankun/cookbook">Tutorial</a><ul role="slug-list"><li title="How to choose the routing mode of micro app" data-depth="2"><a href="/qiankun/cookbook#how-to-choose-the-routing-mode-of-micro-app"><span>How to choose the routing mode of micro app</span></a></li><li title="activeRule uses location.pathname to distinguish micro apps" data-depth="3"><a href="/qiankun/cookbook#activerule-uses-locationpathname-to-distinguish-micro-apps"><span>activeRule uses location.pathname to distinguish micro apps</span></a></li><li title="activeRule uses hash to distinguish micro apps" data-depth="3"><a href="/qiankun/cookbook#activerule-uses-hash-to-distinguish-micro-apps"><span>activeRule uses hash to distinguish micro apps</span></a></li><li title="When there are multiple micro apps at the same time" data-depth="3"><a href="/qiankun/cookbook#when-there-are-multiple-micro-apps-at-the-same-time"><span>When there are multiple micro apps at the same time</span></a></li><li title="How to deploy" data-depth="2"><a href="/qiankun/cookbook#how-to-deploy"><span>How to deploy</span></a></li><li title="Scenario 1: The main app and micro apps are deployed to the same server (the same IP and port)" data-depth="3"><a href="/qiankun/cookbook#scenario-1-the-main-app-and-micro-apps-are-deployed-to-the-same-server-the-same-ip-and-port"><span>Scenario 1: The main app and micro apps are deployed to the same server (the same IP and port)</span></a></li><li title="Scenario 2: The main app and micro apps are deployed on different servers and accessed through Nginx proxy" data-depth="3"><a href="/qiankun/cookbook#scenario-2-the-main-app-and-micro-apps-are-deployed-on-different-servers-and-accessed-through-nginx-proxy"><span>Scenario 2: The main app and micro apps are deployed on different servers and accessed through Nginx proxy</span></a></li><li title="Upgrade from 1.x version to 2.x version" data-depth="2"><a href="/qiankun/cookbook#upgrade-from-1x-version-to-2x-version"><span>Upgrade from 1.x version to 2.x version</span></a></li></ul></li></ul></div></div><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="tutorial"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#tutorial"><span class="icon icon-link"></span></a>Tutorial</h1><h2 id="how-to-choose-the-routing-mode-of-micro-app"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#how-to-choose-the-routing-mode-of-micro-app"><span class="icon icon-link"></span></a>How to choose the routing mode of micro app</h2><p>The three routes <code>react-router</code>, <code>angular-router</code>, and <code>vue-router</code> all support the <code>hash</code> and <code>history</code> modes. The different modes used by micro apps are slightly different in <code>qiankun</code>.</p><h3 id="activerule-uses-locationpathname-to-distinguish-micro-apps"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#activerule-uses-locationpathname-to-distinguish-micro-apps"><span class="icon icon-link"></span></a><code>activeRule</code> uses <code>location.pathname</code> to distinguish micro apps</h3><p>When the main app uses <code>location.pathname</code> to distinguish micro apps, micro apps can be in <code>hash</code> and <code>history</code> modes.</p><p>When registering micro apps, <code>activeRule</code> needs to be written like this:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;http://localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/app&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><ol><li><p>When the micro app is in <code>history</code> mode, just set the route <code>base</code>.</p></li><li><p>When the micro app is in the <code>hash</code> mode, the performance of the three routes is inconsistent</p><table><thead><tr><th>routing</th><th>main app jump <code>/app/#/about</code></th><th>special configuration</th></tr></thead><tbody><tr><td>vue-router</td><td>Response <code>about</code> routing</td><td>none</td></tr><tr><td>react-router</td><td>not responding <code>about</code> routing</td><td>none</td></tr><tr><td>angular-router</td><td>Response <code>about</code> routing</td><td>need to set <code>--base-href</code></td></tr></tbody></table><p><code>Angular</code> app set <code>--base-href</code> in <code>package.json</code>:</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> &quot;start&quot;: &quot;ng serve&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> &quot;start&quot;: &quot;ng serve --base-href /angular9&quot;,</span></div><div class="token-line"><span class="token inserted-sign inserted line"></span><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> &quot;build&quot;: &quot;ng build&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> &quot;build&quot;: &quot;ng build --base-href /angular9&quot;,</span></div></pre></div><p>After bundled and deployed, the <code>angular</code> micro app can be accessed by the main app, but the lazy-loaded route during independent access will report an error and the path is incorrect. There are two solutions:</p><ul><li><p>Solution 1: Modify <code>public-path.js</code> to:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">__webpack_public_path__ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">?</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">http://</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">ip</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">:</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">port</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">/</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// Fill in your actual deployment address</span></div></pre></div></li><li><p>Solution 2: Modify the bundling command and deploy the micro app in the <code>angular9</code> directory:</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> &quot;build&quot;: &quot;ng build&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> &quot;build&quot;: &quot;ng build --base-href /angular9 --deploy-url /angular9/&quot;,</span></div></pre></div></li></ul></li></ol><h3 id="activerule-uses-hash-to-distinguish-micro-apps"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#activerule-uses-hash-to-distinguish-micro-apps"><span class="icon icon-link"></span></a>activeRule uses hash to distinguish micro apps</h3><p>When the micro apps are all in the <code>hash</code> mode, <code>hash</code> can be used to distinguish the micro apps, and the routing mode of the main app is not limited.</p><p>When registering micro apps, <code>activeRule</code> needs to be written like this:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">getActiveRule</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">hash</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">location</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token property-access">hash</span><span class="token punctuation">.</span><span class="token method function property-access">startsWith</span><span class="token punctuation">(</span><span class="token plain">hash</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app-hash&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;http://localhost:8080&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">getActiveRule</span><span class="token punctuation">(</span><span class="token string">&#x27;#/app-hash&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Here you can also write `activeRule:&#x27;#/app-hash&#x27;` directly,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// but if the main app is in history mode or the main app is deployed in a non-root directory, this writing will not take effect.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre></div><p>The <code>react-router</code> and <code>angular-router</code> micro-apps need to set the value of <code>activeRule</code> to the route&#x27;s <code>base</code>, written in the same way as <code>history</code>.</p><p>In the <code>hash</code> mode of the <code>vue-router</code> app, the <code>base</code> for routing is not supported. You need to create an additional empty routing page and use all other routes as its children:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> routes </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue-hash&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;Home&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    component</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Home</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// All other routes are written here</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><h3 id="when-there-are-multiple-micro-apps-at-the-same-time"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#when-there-are-multiple-micro-apps-at-the-same-time"><span class="icon icon-link"></span></a>When there are multiple micro apps at the same time</h3><p>If a page displays multiple micro apps at the same time, you need to use <code>loadMicroApp</code> to load them.</p><p>If these micro apps have routing jump requirements, to ensure that these routes do not interfere with each other, you need to use the <code>momery</code> routing. <code>vue-router</code> uses the <code>abstract</code> mode, <code>react-router</code> uses the <code>memory history</code> mode, and <code>angular-router</code> does not support it.</p><h2 id="how-to-deploy"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#how-to-deploy"><span class="icon icon-link"></span></a>How to deploy</h2><p><strong>Recommendation</strong>: The main app and micro apps are developed and deployed independently, that is, they belong to different git repositories and services.</p><h3 id="scenario-1-the-main-app-and-micro-apps-are-deployed-to-the-same-server-the-same-ip-and-port"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#scenario-1-the-main-app-and-micro-apps-are-deployed-to-the-same-server-the-same-ip-and-port"><span class="icon icon-link"></span></a>Scenario 1: The main app and micro apps are deployed to the same server (the same IP and port)</h3><p>If the number of servers is limited, or cannot be cross-domain and other reasons, the main app and micro apps need to be deployed together.</p><p>The usual practice is to deploy the main app in the first-level directory and the micro apps in the second/third-level directory.</p><p>If you want to deploy a micro app in a non-root directory, you need to do two things before bundling the micro app:</p><ol><li><p>You must configure the <code>publicPath</code> when building <code>webpack</code> as the <strong>directory name</strong>. For more information, please see <a target="_blank" rel="noopener noreferrer" href="https://webpack.js.org/configuration/output/#outputpublicpath">webpack official instructions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a target="_blank" rel="noopener noreferrer" href="https://cli.vuejs.org/config/#publicpath">vue-cli3 official instructions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li><li><p>The micro app of the <code>history</code> route needs to set the <code>base</code>, the value is <strong>directory name</strong>, which is used when the micro app is accessed independently.</p></li></ol><p>Pay attention to three points after deployment:</p><ol><li><code>activeRule</code> cannot be the same as <strong>the real access path of the micro app</strong>, otherwise it will directly become the micro app page when refreshed on the main app page.</li><li>The real access path of the micro app is the <code>entry</code> of the micro app, and the <code>entry</code> can be a relative path.</li><li>The <code>/</code> at the end of the <code>entry</code> path of the micro app cannot be omitted, otherwise the <code>publicPath</code> will be set incorrectly. For example, if the access path of the child item is <code>http://localhost:8080/app1</code>, then <code>entry</code> It is <code>http://localhost:8080/app1/</code>.</li></ol><p>There are two specific deployment methods, choose one of them.</p><h4 id="solution-1-all-micro-apps-are-placed-in-a-folder-with-a-special-name-that-do-not-have-the-same-name-as-micro-apps-recommended"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#solution-1-all-micro-apps-are-placed-in-a-folder-with-a-special-name-that-do-not-have-the-same-name-as-micro-apps-recommended"><span class="icon icon-link"></span></a>Solution 1: All micro apps are placed in a folder with a special name that do not have the same name as micro apps (<strong>recommended</strong>)</h4><p>Suppose we have a main app and 6 micro apps ( respectively <code>vue-hash</code>, <code>vue-history</code>, <code>react-hash</code>, <code>react-history</code>, <code>angular-hash</code>, <code>angular-history</code>) And place it as follows after bundling:</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">└── html/                     # root folder</span></div><div class="token-line"><span class="token plain">    |</span></div><div class="token-line"><span class="token plain">    ├── child/                # the folder of all micro apps</span></div><div class="token-line"><span class="token plain">    |   ├── vue-hash/         # the folder of the micro app `vue-hash`</span></div><div class="token-line"><span class="token plain">    |   ├── vue-history/      # the folder of the micro app `vue-history`</span></div><div class="token-line"><span class="token plain">    |   ├── react-hash/       # the folder of the micro app `react-hash`</span></div><div class="token-line"><span class="token plain">    |   ├── react-history/    # the folder of the micro app `react-history`</span></div><div class="token-line"><span class="token plain">    |   ├── angular-hash/     # the folder of the micro app `angular-hash`</span></div><div class="token-line"><span class="token plain">    |   ├── angular-history/  # the folder of the micro app `angular-history`</span></div><div class="token-line"><span class="token plain">    ├── index.html            # index.html of the main app</span></div><div class="token-line"><span class="token plain">    ├── css/                  # the css folder of the main app</span></div><div class="token-line"><span class="token plain">    ├── js/                   # the js folder of the main app</span></div></pre></div><p>At this time, you need to set the <code>publicPath</code> and the route <code>base</code> of the <code>history</code> mode when the micro app is built, and then bundle them into the corresponding directory.</p><table><thead><tr><th>app</th><th>routing base</th><th>publicPath</th><th>real access path</th></tr></thead><tbody><tr><td>vue-hash</td><td>none</td><td>/child/vue-hash/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/vue-hash/">http://localhost:8080/child/vue-hash/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr><tr><td>vue-history</td><td>/child/vue-history/</td><td>/child/vue-history/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/vue-history/">http://localhost:8080/child/vue-history/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr><tr><td>react-hash</td><td>none</td><td>/child/react-hash/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/react-hash/">http://localhost:8080/child/react-hash/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr><tr><td>react-history</td><td>/child/react-history/</td><td>/child/react-history/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/react-history/">http://localhost:8080/child/react-history/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr><tr><td>angular-hash</td><td>none</td><td>/child/angular-hash/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/angular-hash/">http://localhost:8080/child/angular-hash/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr><tr><td>angular-history</td><td>/child/angular-history/</td><td>/child/angular-history/</td><td><a target="_blank" rel="noopener noreferrer" href="http://localhost:8080/child/angular-history/">http://localhost:8080/child/angular-history/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr></tbody></table><ul><li><p><code>vue-history</code> micro app</p><p>Routing&#x27;s base configuration:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">base</span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/vue-history/&#x27;</span><span class="token punctuation">,</span></div></pre></div><p>Webpack&#x27;s publicPath configuration（<code>vue.config.js</code>）:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  publicPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/vue-history/&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div></li><li><p><code>react-history</code> micro app</p><p>Routing&#x27;s base configuration:</p><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&lt;BrowserRouter basename={window.__POWERED_BY_QIANKUN__ ? &#x27;/app-react&#x27; : &#x27;/child/react-history/&#x27;}&gt;</span></div></pre></div><p>Webpack&#x27;s publicPath configuration:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    publicPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/react-history/&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div></li><li><p><code>angular-history</code> micro app</p><p>Routing&#x27;s base configuration:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">providers</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    provide</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant">APP_BASE_HREF</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    useValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">__POWERED_BY_QIANKUN__</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&#x27;/app-angular/&#x27;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/angular-history/&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">;</span></div></pre></div><p>The <code>publicPath</code> of webpack is set by <code>deploy-url</code>, modify <code>package.json</code>:</p><div class="__dumi-default-code-block"><pre class="prism-code language-diff"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token deleted-sign deleted prefix deleted">-</span><span class="token deleted-sign deleted line"> &quot;build&quot;: &quot;ng build&quot;,</span></div><div class="token-line"><span class="token deleted-sign deleted line"></span><span class="token inserted-sign inserted prefix inserted">+</span><span class="token inserted-sign inserted line"> &quot;build&quot;: &quot;ng build --deploy-url /child/angular-history/&quot;,</span></div></pre></div></li></ul><p>Then the <code>registerMicroApps</code> function at this time is like this (you need to ensure that <code>activeRule</code> and <code>entry</code> are different):</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app-vue-hash&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/vue-hash/&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// http://localhost:8080/child/vue-hash/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue-hash&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app-vue-history&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child/vue-history/&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// http://localhost:8080/child/vue-history/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/app-vue-history&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// angular and react same as above</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></pre></div><p>So far, the main app and the micro apps can run normally, but the main app and the <code>vue-history</code>, <code>react-history</code>, and <code>angular-history</code> micro apps are <code>history</code> routes. The problem of refreshing 404 needs to be solved. nginx` also needs to be configured:</p><div class="__dumi-default-code-block"><pre class="prism-code language-conf"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">server {</span></div><div class="token-line"><span class="token plain">  listen       8080;</span></div><div class="token-line"><span class="token plain">  server_name  localhost;</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  location / {</span></div><div class="token-line"><span class="token plain">    root   html;</span></div><div class="token-line"><span class="token plain">    index  index.html index.htm;</span></div><div class="token-line"><span class="token plain">    try_files $uri $uri/ /index.html;</span></div><div class="token-line"><span class="token plain">  }</span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">  location /child/vue-history {</span></div><div class="token-line"><span class="token plain">    root   html;</span></div><div class="token-line"><span class="token plain">    index  index.html index.htm;</span></div><div class="token-line"><span class="token plain">    try_files $uri $uri/ /child/vue-history/index.html;</span></div><div class="token-line"><span class="token plain">  }</span></div><div class="token-line"><span class="token plain">  # The configuration of angular-history and react-history is the same as above</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><h4 id="solution-2-place-the-micro-apps-directly-in-the-secondary-directory-but-set-a-special-activerule"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#solution-2-place-the-micro-apps-directly-in-the-secondary-directory-but-set-a-special-activerule"><span class="icon icon-link"></span></a>Solution 2: Place the micro apps directly in the secondary directory, but set a special <code>activeRule</code></h4><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">└── html/                 # root folder</span></div><div class="token-line"><span class="token plain">    |</span></div><div class="token-line"><span class="token plain">    ├── vue-hash/         # the folder of the micro app `vue-hash`</span></div><div class="token-line"><span class="token plain">    ├── vue-history/      # the folder of the micro app `vue-history`</span></div><div class="token-line"><span class="token plain">    ├── react-hash/       # the folder of the micro app `react-hash`</span></div><div class="token-line"><span class="token plain">    ├── react-history/    # the folder of the micro app `react-history`</span></div><div class="token-line"><span class="token plain">    ├── angular-hash/     # the folder of the micro app `angular-hash`</span></div><div class="token-line"><span class="token plain">    ├── angular-history/  # the folder of the micro app `angular-history`</span></div><div class="token-line"><span class="token plain">    ├── index.html        # index.html of the main app</span></div><div class="token-line"><span class="token plain">    ├── css/              # the css folder of the main app</span></div><div class="token-line"><span class="token plain">    ├── js/               # the js folder of the main app</span></div></pre></div><p>The basic operation is the same as above, just make sure that <code>activeRule</code> is different from the storage path name of the micro app.</p><h3 id="scenario-2-the-main-app-and-micro-apps-are-deployed-on-different-servers-and-accessed-through-nginx-proxy"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#scenario-2-the-main-app-and-micro-apps-are-deployed-on-different-servers-and-accessed-through-nginx-proxy"><span class="icon icon-link"></span></a>Scenario 2: The main app and micro apps are deployed on different servers and accessed through Nginx proxy</h3><p>This is generally done because <strong>the main app is not allowed to access micro apps across domains</strong>. The practice is to forward all requests for a special path on the main app server to the micro app server, that is, a &quot;micro app deployed on the main app server&quot; effect is achieved through the proxy.</p><p>For example, the main app is on the A server, and the micro app is on the B server. The path <code>/app1</code> is used to distinguish the micro app, that is, all requests starting with <code>/app1</code> on the A server are forwarded to the B server.</p><p>the <code>Nginx</code> proxy configuration of the main app is：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">/app1/ {</span></div><div class="token-line"><span class="token plain">  proxy_pass http://www.b.com/app1/;</span></div><div class="token-line"><span class="token plain">  proxy_set_header Host $host:$server_port;</span></div><div class="token-line"><span class="token plain">}</span></div></pre></div><p>When the main app registers micro apps, <code>entry</code> can be a relative path, and <code>activeRule</code> cannot be the same as <code>entry</code> (otherwise the main app page refreshes and becomes a micro app):</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">registerMicroApps</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    entry</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/app1/&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// http://localhost:8080/app1/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    container</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    activeRule</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;/child-app1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">]</span><span class="token punctuation">,</span></div></pre></div><p>For micro apps bundled by <code>webpack</code>, the <code>publicPath</code> bundled by the micro app&#x27;s <code>webpack</code> needs to be configured as <code>/app1/</code>, otherwise the micro app&#x27;s <code>index.html</code> can be requested correctly, But the path of <code>js/css</code> in the micro app&#x27;s <code>index.html</code> will not carry <code>/app1/</code>.</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  output</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    publicPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/app1/</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre></div><p>After adding <code>/app1/</code> to the <code>publicPath</code> of the micro app, it must be deployed in the <code>/app1</code> directory, otherwise it cannot be accessed independently.</p><p>In addition, if you don&#x27;t want the micro app to be accessed independently through the proxy path, you can judge based on some information requested. The requesting micro app in the main app is requested with <code>fetch</code>, which can include parameters and <code>cookie</code>. For example, judge by request header parameters:</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">$http_custom_referer </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  rewrite </span><span class="token operator">/</span><span class="token plain">index </span><span class="token operator">/</span><span class="token number">404.</span><span class="token plain">html</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre></div><h2 id="upgrade-from-1x-version-to-2x-version"><a aria-hidden="true" tabindex="-1" href="/qiankun/cookbook#upgrade-from-1x-version-to-2x-version"><span class="icon icon-link"></span></a>Upgrade from 1.x version to 2.x version</h2><p>The micro apps does not need to be changed, and the main app needs to be adjusted.</p><p>The basic modification of <code>registerMicroApps</code> function is as follows:</p><ol><li>Remove the <code>render</code> parameter and only need to provide the container.</li><li>Add the <code>loader</code> parameter to display the <code>loading</code> status. Originally, the <code>loading</code> status was provided to the <code>render</code> parameter.</li><li>The <code>activeRule</code> parameter can be abbreviated as <code>/app</code>, which is compatible with the previous function writing.</li><li>The <code>RegisterMicroAppsOpts</code> parameter is removed and placed in the parameter of the <code>start</code> function.</li></ol><p>The basic modification of the <code>start</code> function is as follows:</p><ol><li>The <code>jsSandbox</code> configuration has been removed and changed to <code>sandbox</code>, and the optional values have also been modified.</li><li>Added <code>getPublicPath</code> and <code>getTemplate</code> to replace <code>RegisterMicroAppsOpts</code>.</li></ol></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/kuitos/qiankun/edit/master/docs/cookbook/README.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last update: ">8/4/2021 05:25:14</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-157295698-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/qiankun/umi.5fd4aa07.js"></script>
  </body>
</html>
